(this["webpackJsonpreact-noise-monitor"]=this["webpackJsonpreact-noise-monitor"]||[]).push([[0],{13:function(e,t,s){},15:function(e,t,s){},16:function(e,t,s){"use strict";s.r(t);var c=s(1),n=s.n(c),r=s(4),a=(s(13),s(0));const l=e=>{let{alert:t}=e;return t.show?Object(a.jsx)("div",{className:"alert",children:Object(a.jsx)("p",{children:t.message})}):null},i=e=>{let{plants:t}=e;const s=e=>{switch(e){case"seedling":return"\ud83c\udf31";case"tree":return"\ud83c\udf32";case"flower":return"\ud83c\udf38"}};return Object(a.jsx)("div",{className:"garden",children:t.map((e=>Object(a.jsx)("span",{className:"plant",children:s(e.type)},e.id)))})},o={MAX_SECONDS:5,UPDATE_INTERVAL:1e3},d={MAX_DECIBEL:20,ALERT_THRESHOLD:15},j=e=>{let{decibel:t,maxDecibel:s,alertThreshold:c}=e;const n=t/d.MAX_DECIBEL*100;return Object(a.jsxs)("div",{className:"noise-bar",children:[Object(a.jsx)("div",{className:"bar-container",children:Object(a.jsx)("div",{className:"bar-fill",style:{width:`${n}%`,backgroundColor:t>=c?"#ff4444":"#44ff44"}})}),Object(a.jsxs)("div",{className:"decibel-value",children:[t.toFixed(1)," / ",s," dB"]})]})},b=e=>{let{isOpen:t,onClose:s,settings:n,onSave:r}=e;const[l,i]=Object(c.useState)(n);return t?Object(a.jsx)("div",{className:"settings-dialog",children:Object(a.jsxs)("div",{className:"settings-content",children:[Object(a.jsx)("h2",{children:"\u8bbe\u7f6e"}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u8ba1\u65f6\u65f6\u95f4\uff08\u79d2\uff09\uff1a"}),Object(a.jsx)("input",{type:"number",value:l.maxSeconds,onChange:e=>i((t=>({...t,maxSeconds:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u6700\u5927\u5206\u8d1d\uff1a"}),Object(a.jsx)("input",{type:"number",value:l.maxDecibel,onChange:e=>i((t=>({...t,maxDecibel:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u8b66\u544a\u9608\u503c\uff1a"}),Object(a.jsx)("input",{type:"number",value:l.alertThreshold,onChange:e=>i((t=>({...t,alertThreshold:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"dialog-buttons",children:[Object(a.jsx)("button",{onClick:()=>r(l),children:"\u4fdd\u5b58"}),Object(a.jsx)("button",{onClick:s,children:"\u53d6\u6d88"})]})]})}):null},h=e=>{let{seconds:t,maxSeconds:s}=e;const c=Math.min(t/o.MAX_SECONDS*100,100),n=e=>`${e.toString().padStart(2,"0")}`;return Object(a.jsxs)("div",{className:"timer",children:[Object(a.jsx)("div",{className:"timer-bar",children:Object(a.jsx)("div",{className:"timer-fill",style:{width:`${c}%`,transition:"width 0.3s ease-in-out"}})}),Object(a.jsxs)("div",{className:"timer-value",children:[n(t),"s / ",n(s),"s"]})]})},m="quiet_garden_data",u={maxSeconds:5,maxDecibel:20,alertThreshold:15,treesToFlower:2,seedlingsToTree:2},O=()=>{const e=localStorage.getItem(m);return e?JSON.parse(e):{plants:[],settings:u}},x=e=>{localStorage.setItem(m,JSON.stringify(e))},g=()=>{localStorage.setItem(m,JSON.stringify({plants:[],settings:u}))};let p=0;const f=()=>`plant_${Date.now()}_${++p}`;var v=()=>{const e=(()=>{const[e,t]=Object(c.useState)(0);return Object(c.useEffect)((()=>{let e,s,c;return(async()=>{try{const n=await navigator.mediaDevices.getUserMedia({audio:!0});e=new AudioContext,s=e.createAnalyser(),c=e.createMediaStreamSource(n),c.connect(s),s.fftSize=256;const r=new Uint8Array(s.frequencyBinCount),a=()=>{s.getByteFrequencyData(r);const e=r.reduce(((e,t)=>e+t))/r.length/255*50;t(Math.round(e)),requestAnimationFrame(a)};a()}catch(n){console.error("Error accessing microphone:",n)}})(),()=>{e&&e.close()}}),[]),e})(),[t,s]=Object(c.useState)(0),[n,r]=Object(c.useState)([]),[d,m]=Object(c.useState)({show:!1,message:""}),[u,p]=Object(c.useState)(!1),[v,S]=Object(c.useState)((()=>O().settings)),N=Object(c.useRef)(null);Object(c.useRef)(!1);Object(c.useEffect)((()=>{const e=O();r(e.plants),S(e.settings)}),[]),Object(c.useEffect)((()=>{x({plants:n,settings:v})}),[n,v]),Object(c.useEffect)((()=>{e>=v.alertThreshold?(s(0),m({show:!0,message:"\u566a\u97f3\u592a\u5927\u4e86\uff01\u8bf7\u4fdd\u6301\u5b89\u9759\u3002"}),setTimeout((()=>m({show:!1,message:""})),3e3)):N.current||(N.current=setInterval((()=>{s((e=>e<v.maxSeconds?e+1:0))}),o.UPDATE_INTERVAL))}),[e,v.maxSeconds,v.alertThreshold]);t===v.maxSeconds&&(r((e=>{const t=e.filter((e=>"seedling"===e.type));return e.filter((e=>"tree"===e.type)).length>=v.treesToFlower-1&&t.length>=v.seedlingsToTree-1?[...e.filter((e=>"tree"!==e.type&&"seedling"!==e.type)),{id:f(),type:"flower"}]:t.length>=v.seedlingsToTree-1?[...e.filter((e=>"seedling"!==e.type)),{id:f(),type:"tree"}]:[...e,{id:f(),type:"seedling"}]})),s(0));return Object(a.jsxs)("div",{className:"app",children:[Object(a.jsxs)("div",{className:"header",children:[Object(a.jsx)("button",{onClick:()=>p(!0),children:"\u2699\ufe0f \u8bbe\u7f6e"}),Object(a.jsx)("button",{onClick:()=>{if(window.confirm("\u786e\u5b9a\u8981\u91cd\u7f6e\u82b1\u56ed\u5417\uff1f")){g();const e=O();r(e.plants),S(e.settings),s(0)}},children:"\ud83d\udd04 \u91cd\u7f6e\u82b1\u56ed"})]}),Object(a.jsxs)("div",{className:"monitor-section",children:[Object(a.jsx)("div",{className:"monitor-title",children:"\ud83c\udf31 \u4fdd\u6301\u5b89\u9759\uff0c\u8ba9\u82b1\u56ed\u6162\u6162\u957f\u5927\u5427\uff01"}),Object(a.jsxs)("div",{className:"timer-section",children:[Object(a.jsx)("h3",{children:"\ud83d\udd52 \u5b89\u9759\u65f6\u95f4"}),Object(a.jsx)(h,{seconds:t,maxSeconds:v.maxSeconds})]}),Object(a.jsxs)("div",{className:"noise-section",children:[Object(a.jsx)("h3",{children:"\ud83d\udd0a \u5f53\u524d\u97f3\u91cf"}),Object(a.jsx)(j,{decibel:e,maxDecibel:v.maxDecibel,alertThreshold:v.alertThreshold})]})]}),Object(a.jsx)("h3",{className:"garden-title",children:"\ud83c\udf3a \u6211\u7684\u5c0f\u82b1\u56ed"}),Object(a.jsx)(i,{plants:n}),Object(a.jsx)(l,{alert:d}),Object(a.jsx)(b,{isOpen:u,onClose:()=>p(!1),settings:v,onSave:e=>{S(e),p(!1)}})]})};s(15);const S=document.getElementById("root");if(!S)throw new Error("Failed to find the root element");Object(r.createRoot)(S).render(Object(a.jsx)(n.a.StrictMode,{children:Object(a.jsx)(v,{})}))}},[[16,1,2]]]);
//# sourceMappingURL=main.568ff9e4.chunk.js.map