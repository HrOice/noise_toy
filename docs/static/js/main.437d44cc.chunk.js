(this["webpackJsonpreact-noise-monitor"]=this["webpackJsonpreact-noise-monitor"]||[]).push([[0],{13:function(e,t,s){},15:function(e,t,s){},16:function(e,t,s){"use strict";s.r(t);var n=s(1),c=s.n(n),r=s(4),a=(s(13),s(0));const l=e=>{let{alert:t}=e;return t.show?Object(a.jsx)("div",{className:"alert",children:Object(a.jsx)("p",{children:t.message})}):null},i=e=>{let{plants:t}=e;const s=e=>{switch(e){case"seedling":return"\ud83c\udf31";case"tree":return"\ud83c\udf32";case"flower":return"\ud83c\udf38"}};return Object(a.jsx)("div",{className:"garden",children:t.map((e=>Object(a.jsx)("span",{className:"plant",children:s(e.type)},e.id)))})},o=e=>{let{decibel:t,maxDecibel:s,alertThreshold:c}=e;const[r,l]=Object(n.useState)([]),i=Object(n.useRef)(0),o=Math.min(t/s*100,100),d=t>=c;return Object(n.useEffect)((()=>{const e={id:i.current,value:t};i.current+=1,l((t=>[...t,e]));const s=setTimeout((()=>{l((t=>t.filter((t=>t.id!==e.id))))}),2e3);return()=>clearTimeout(s)}),[t]),Object(a.jsxs)("div",{className:"noise-bar "+(d?"warning":""),children:[r.map((e=>Object(a.jsx)("div",{className:"noise-fill peak "+(d?"warning":""),style:{width:`${Math.min(e.value/s*100,100)}%`}},e.id))),Object(a.jsx)("div",{className:"noise-fill current "+(d?"warning":""),style:{width:`${o}%`}}),Object(a.jsxs)("span",{className:"value-display",children:[t.toFixed(1)," dB"]})]})},d=e=>{let{isOpen:t,onClose:s,settings:c,onSave:r}=e;const[l,i]=Object(n.useState)(c);return t?Object(a.jsx)("div",{className:"settings-dialog",children:Object(a.jsxs)("div",{className:"settings-content",children:[Object(a.jsx)("h2",{children:"\ud83d\udee0\ufe0f \u8bbe\u7f6e"}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u8ba1\u65f6\u65f6\u95f4\uff08\u79d2\uff09\uff1a"}),Object(a.jsx)("input",{type:"number",min:"1",value:l.maxSeconds,onChange:e=>i((t=>({...t,maxSeconds:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u6700\u5927\u5206\u8d1d\uff1a"}),Object(a.jsx)("input",{type:"number",min:"1",value:l.maxDecibel,onChange:e=>i((t=>({...t,maxDecibel:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u8b66\u544a\u9608\u503c\uff1a"}),Object(a.jsx)("input",{type:"number",min:"1",value:l.alertThreshold,onChange:e=>i((t=>({...t,alertThreshold:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u6811\u82d7\u5347\u7ea7\u6570\u91cf\uff1a"}),Object(a.jsx)("input",{type:"number",min:"1",value:l.seedlingsToTree,onChange:e=>i((t=>({...t,seedlingsToTree:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{children:"\u6811\u6728\u5347\u7ea7\u6570\u91cf\uff1a"}),Object(a.jsx)("input",{type:"number",min:"1",value:l.treesToFlower,onChange:e=>i((t=>({...t,treesToFlower:Number(e.target.value)})))})]}),Object(a.jsxs)("div",{className:"dialog-buttons",children:[Object(a.jsx)("button",{onClick:()=>r(l),children:"\u4fdd\u5b58"}),Object(a.jsx)("button",{className:"cancel",onClick:s,children:"\u53d6\u6d88"})]})]})}):null},j=e=>{let{seconds:t,maxSeconds:s}=e;const n=Math.min(t/s*100,100);return Object(a.jsxs)("div",{className:"timer-bar",children:[Object(a.jsx)("div",{className:"timer-fill",style:{width:`${n}%`}}),Object(a.jsxs)("span",{className:"value-display",children:[t,"s / ",s,"s"]})]})},u={MAX_SECONDS:5,UPDATE_INTERVAL:1e3},b="quiet_garden_data",m={maxSeconds:5,maxDecibel:20,alertThreshold:15,seedlingsToTree:5,treesToFlower:5},h=()=>{const e=localStorage.getItem(b);return e?JSON.parse(e):{plants:[],settings:m}},O=e=>{localStorage.setItem(b,JSON.stringify(e))},x=()=>{localStorage.setItem(b,JSON.stringify({plants:[],settings:m}))};let g=0;const p=()=>`plant_${Date.now()}_${++g}`;var v=()=>{const e=(()=>{const[e,t]=Object(n.useState)(0);return Object(n.useEffect)((()=>{let e,s,n;return(async()=>{try{const c=await navigator.mediaDevices.getUserMedia({audio:!0});e=new AudioContext,s=e.createAnalyser(),n=e.createMediaStreamSource(c),n.connect(s),s.fftSize=256;const r=new Uint8Array(s.frequencyBinCount),a=()=>{s.getByteFrequencyData(r);const e=r.reduce(((e,t)=>e+t))/r.length/255*50;t(Math.round(e)),requestAnimationFrame(a)};a()}catch(c){console.error("Error accessing microphone:",c)}})(),()=>{e&&e.close()}}),[]),e})(),[t,s]=Object(n.useState)(0),[c,r]=Object(n.useState)([]),[b,m]=Object(n.useState)({show:!1,message:""}),[g,v]=Object(n.useState)(!1),[f,N]=Object(n.useState)((()=>h().settings)),S=Object(n.useRef)(f),y=Object(n.useRef)(null),[T,w]=(Object(n.useRef)(!1),Object(n.useState)(!1));Object(n.useEffect)((()=>{const e=h();r(e.plants),N(e.settings),w(!0)}),[]),Object(n.useEffect)((()=>{T&&O({plants:c,settings:f})}),[c,f,T]),Object(n.useEffect)((()=>{e>=S.current.alertThreshold?(s(0),m({show:!0,message:"\u566a\u97f3\u592a\u5927\u4e86\uff01\u8bf7\u4fdd\u6301\u5b89\u9759\u3002"}),setTimeout((()=>m({show:!1,message:""})),3e3)):y.current||(y.current=setInterval((()=>{s((e=>e<S.current.maxSeconds?e+1:0))}),u.UPDATE_INTERVAL))}),[e,f.maxSeconds,f.alertThreshold]);t===f.maxSeconds&&(r((e=>{const t=e.filter((e=>"seedling"===e.type));return e.filter((e=>"tree"===e.type)).length>=S.current.treesToFlower-1&&t.length>=S.current.seedlingsToTree-1?[...e.filter((e=>"tree"!==e.type&&"seedling"!==e.type)),{id:p(),type:"flower"}]:t.length>=S.current.seedlingsToTree-1?[...e.filter((e=>"seedling"!==e.type)),{id:p(),type:"tree"}]:[...e,{id:p(),type:"seedling"}]})),s(0));return Object(a.jsxs)("div",{className:"app",children:[Object(a.jsxs)("div",{className:"header",children:[Object(a.jsx)("button",{onClick:()=>v(!0),children:"\u2699\ufe0f"}),Object(a.jsx)("button",{onClick:()=>{if(window.confirm("\u786e\u5b9a\u8981\u91cd\u7f6e\u82b1\u56ed\u5417\uff1f")){x();const e=h();r(e.plants),s(0)}},children:"\ud83d\udd04"})]}),Object(a.jsxs)("div",{className:"monitor-section",children:[Object(a.jsx)("div",{className:"monitor-title",children:"\ud83c\udf31 \u4fdd\u6301\u5b89\u9759\uff0c\u8ba9\u82b1\u56ed\u6210\u957f"}),Object(a.jsxs)("div",{className:"timer-section",children:[Object(a.jsx)("h3",{children:"\ud83d\udd52 \u5b89\u9759\u65f6\u95f4"}),Object(a.jsx)(j,{seconds:t,maxSeconds:S.current.maxSeconds})]}),Object(a.jsxs)("div",{className:"noise-section",children:[Object(a.jsx)("h3",{children:"\ud83d\udd0a \u5f53\u524d\u97f3\u91cf"}),Object(a.jsx)(o,{decibel:e,maxDecibel:S.current.maxDecibel,alertThreshold:S.current.alertThreshold})]})]}),Object(a.jsx)(i,{plants:c}),Object(a.jsx)(l,{alert:b}),Object(a.jsx)(d,{isOpen:g,onClose:()=>v(!1),settings:S.current,onSave:e=>{N({...e}),S.current=e,v(!1)}})]})};s(15);const f=document.getElementById("root");if(!f)throw new Error("Failed to find the root element");Object(r.createRoot)(f).render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(v,{})}))}},[[16,1,2]]]);
//# sourceMappingURL=main.437d44cc.chunk.js.map