(this["webpackJsonpreact-noise-monitor"]=this["webpackJsonpreact-noise-monitor"]||[]).push([[0],{13:function(e,t,s){},14:function(e,t,s){},16:function(e,t,s){},17:function(e,t,s){"use strict";s.r(t);var n=s(1),c=s.n(n),r=s(4),l=(s(13),s(14),s(0));const a=e=>{let{alert:t}=e;return t.show?Object(l.jsx)("div",{className:"alert",children:Object(l.jsxs)("div",{className:"alert-content",children:[Object(l.jsx)("div",{className:"alert-icon",children:"!"}),Object(l.jsxs)("div",{className:"alert-message",children:[Object(l.jsx)("div",{className:"alert-text",children:"\u58f0\u97f3\u592a\u5927\u4e86"}),Object(l.jsx)("div",{className:"alert-text",children:"\u8bf7\u4fdd\u6301\u5b89\u9759"})]})]})}):null},i=e=>{let{plants:t}=e;const s=e=>{switch(e){case"seedling":return"\ud83c\udf31";case"tree":return"\ud83c\udf32";case"flower":return"\ud83c\udf38"}};return Object(l.jsx)("div",{className:"garden",children:t.map((e=>Object(l.jsx)("span",{className:"plant",children:s(e.type)},e.id)))})},o=e=>{let{decibel:t,maxDecibel:s,alertThreshold:c}=e;const[r,a]=Object(n.useState)([]),i=Object(n.useRef)(0),o=Math.min(t/s*100,100),d=t>=c;return Object(n.useEffect)((()=>{const e={id:i.current,value:t};i.current+=1,a((t=>[...t,e]));setTimeout((()=>{a((t=>t.filter((t=>t.id!==e.id))))}),2e3)}),[t]),Object(l.jsxs)("div",{className:"noise-bar "+(d?"warning":""),children:[r.map((e=>Object(l.jsx)("div",{id:e.id.toString(),className:"noise-fill peak "+(d?"warning":""),style:{width:`${Math.min(e.value/s*100,100)}%`}},e.id))),Object(l.jsx)("div",{className:"noise-fill current "+(d?"warning":""),style:{width:`${o}%`}}),Object(l.jsxs)("span",{className:"value-display",children:[t.toFixed(1)," dB"]})]})},d=e=>{let{isOpen:t,onClose:s,settings:c,onSave:r}=e;const[a,i]=Object(n.useState)(c);return t?Object(l.jsx)("div",{className:"settings-dialog",children:Object(l.jsxs)("div",{className:"settings-content",children:[Object(l.jsx)("h2",{children:"\ud83d\udee0\ufe0f \u8bbe\u7f6e"}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{children:"\u8ba1\u65f6\u65f6\u95f4\uff08\u79d2\uff09\uff1a"}),Object(l.jsx)("input",{type:"number",min:"1",value:a.maxSeconds,onChange:e=>i((t=>({...t,maxSeconds:Number(e.target.value)})))})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{children:"\u6700\u5927\u5206\u8d1d\uff1a"}),Object(l.jsx)("input",{type:"number",min:"1",value:a.maxDecibel,onChange:e=>i((t=>({...t,maxDecibel:Number(e.target.value)})))})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{children:"\u8b66\u544a\u9608\u503c\uff1a"}),Object(l.jsx)("input",{type:"number",min:"1",value:a.alertThreshold,onChange:e=>i((t=>({...t,alertThreshold:Number(e.target.value)})))})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{children:"\u6811\u82d7\u5347\u7ea7\u6570\u91cf\uff1a"}),Object(l.jsx)("input",{type:"number",min:"1",value:a.seedlingsToTree,onChange:e=>i((t=>({...t,seedlingsToTree:Number(e.target.value)})))})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{children:"\u6811\u6728\u5347\u7ea7\u6570\u91cf\uff1a"}),Object(l.jsx)("input",{type:"number",min:"1",value:a.treesToFlower,onChange:e=>i((t=>({...t,treesToFlower:Number(e.target.value)})))})]}),Object(l.jsxs)("div",{className:"dialog-buttons",children:[Object(l.jsx)("button",{onClick:()=>r(a),children:"\u4fdd\u5b58"}),Object(l.jsx)("button",{className:"cancel",onClick:s,children:"\u53d6\u6d88"})]})]})}):null},u=e=>{let{seconds:t,maxSeconds:s}=e;const n=Math.min(t/s*100,100);return Object(l.jsxs)("div",{className:"timer-bar",children:[Object(l.jsx)("div",{className:"timer-fill",style:{width:`${n}%`}}),Object(l.jsxs)("span",{className:"value-display",children:[t,"s / ",s,"s"]})]})},j={MAX_SECONDS:5,UPDATE_INTERVAL:1e3},b=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const[t,s]=Object(n.useState)(0),c=Object(n.useRef)(null),r=Object(n.useRef)(null),l=Object(n.useRef)(0);return Object(n.useEffect)((()=>{console.log("useAudio");return e||(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});c.current=e;const t=new AudioContext,n=t.createAnalyser();r.current=n,t.createMediaStreamSource(e).connect(n),n.fftSize=256;const a=new Uint8Array(n.frequencyBinCount),i=()=>{n.getByteFrequencyData(a);const e=a.reduce(((e,t)=>e+t))/a.length/255*50;s(Math.round(e)),l.current=requestAnimationFrame(i)};i()}catch(e){console.error("Error accessing microphone:",e)}})(),()=>{console.log("stop media"),l.current&&cancelAnimationFrame(l.current),c.current&&(c.current.getTracks().forEach((e=>e.stop())),c.current=null),r.current&&(r.current.disconnect(),r.current=null),s(0)}}),[e]),t},m="quiet_garden_data",h={maxSeconds:5,maxDecibel:20,alertThreshold:15,seedlingsToTree:5,treesToFlower:5},O=()=>{const e=localStorage.getItem(m);return e?JSON.parse(e):{plants:[],settings:h}},x=e=>{localStorage.setItem(m,JSON.stringify(e))},g=()=>{localStorage.setItem(m,JSON.stringify({plants:[],settings:h}))};let p=0;const v=()=>`plant_${Date.now()}_${++p}`;var f=()=>{const[e,t]=Object(n.useState)(!1),s=b(e),[c,r]=Object(n.useState)(0),[m,h]=Object(n.useState)([]),[p,f]=Object(n.useState)({show:!1,message:""}),[N,S]=Object(n.useState)(!1),[y,T]=Object(n.useState)((()=>O().settings)),w=Object(n.useRef)(y),C=Object(n.useRef)(null),[E,D]=(Object(n.useRef)(!1),Object(n.useState)(!1));Object(n.useEffect)((()=>{const e=O();h(e.plants),T(e.settings),D(!0)}),[]),Object(n.useEffect)((()=>{E&&x({plants:m,settings:y})}),[m,y,E]),Object(n.useEffect)((()=>{s>=w.current.maxDecibel&&r(0),s>=w.current.alertThreshold?(f({show:!0,message:"\u566a\u97f3\u592a\u5927\u4e86\uff01\u8bf7\u4fdd\u6301\u5b89\u9759\u3002"}),setTimeout((()=>f({show:!1,message:""})),3e3)):C.current||e||(console.log("start time"),C.current=setInterval((()=>{r((e=>e<w.current.maxSeconds?e+1:0))}),j.UPDATE_INTERVAL))}),[s,y.maxSeconds,y.alertThreshold]);c===y.maxSeconds&&(h((e=>{const t=e.filter((e=>"seedling"===e.type));return e.filter((e=>"tree"===e.type)).length>=w.current.treesToFlower-1&&t.length>=w.current.seedlingsToTree-1?[...e.filter((e=>"tree"!==e.type&&"seedling"!==e.type)),{id:v(),type:"flower"}]:t.length>=w.current.seedlingsToTree-1?[...e.filter((e=>"seedling"!==e.type)),{id:v(),type:"tree"}]:[...e,{id:v(),type:"seedling"}]})),r(0));return Object(l.jsxs)("div",{className:"app",children:[Object(l.jsxs)("div",{className:"header",children:[Object(l.jsx)("button",{onClick:()=>{e||C.current&&(console.log("stop time"),clearInterval(C.current),C.current=null),console.log(e?"play":"stop"),t((e=>!e))},className:"control-button",children:e?"\u25b6\ufe0f":"\u23f8\ufe0f"}),Object(l.jsx)("button",{onClick:()=>S(!0),children:"\u2699\ufe0f"}),Object(l.jsx)("button",{onClick:()=>{if(window.confirm("\u786e\u5b9a\u8981\u91cd\u7f6e\u82b1\u56ed\u5417\uff1f")){g();const e=O();h(e.plants),r(0)}},children:"\ud83d\udd04"})]}),Object(l.jsxs)("div",{className:"monitor-section",children:[Object(l.jsx)("div",{className:"monitor-title",children:"\ud83c\udf31 \u4fdd\u6301\u5b89\u9759\uff0c\u8ba9\u82b1\u56ed\u6210\u957f"}),Object(l.jsxs)("div",{className:"timer-section",children:[Object(l.jsx)("h3",{children:"\ud83d\udd52 \u5b89\u9759\u65f6\u95f4"}),Object(l.jsx)(u,{seconds:c,maxSeconds:w.current.maxSeconds})]}),Object(l.jsxs)("div",{className:"noise-section",children:[Object(l.jsx)("h3",{children:"\ud83d\udd0a \u5f53\u524d\u97f3\u91cf"}),Object(l.jsx)(o,{decibel:s,maxDecibel:w.current.maxDecibel,alertThreshold:w.current.alertThreshold})]})]}),Object(l.jsx)(i,{plants:m}),Object(l.jsx)(a,{alert:p}),Object(l.jsx)(d,{isOpen:N,onClose:()=>S(!1),settings:w.current,onSave:e=>{T({...e}),w.current=e,S(!1)}})]})};s(16);const N=document.getElementById("root");if(!N)throw new Error("Failed to find the root element");Object(r.createRoot)(N).render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)(f,{})}))}},[[17,1,2]]]);
//# sourceMappingURL=main.a44f1961.chunk.js.map